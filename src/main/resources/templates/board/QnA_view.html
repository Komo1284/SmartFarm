<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>QnA_View</title>
</head>
<body>
<div th:replace="~{piece :: header}"></div>

<h1>질의 응답 게시판 상세 보기</h1>
<hr>

<table th:with="row = ${row}">

    <tr>
        <th th:text="제목"></th>
        <td th:text="${row.title}"></td>
    </tr>
    <tr>
        <th th:text="작성자"></th>
        <td th:text="${row.nick}"></td>
    </tr>
    <tr>
        <th th:text="조회수"></th>
        <td th:text="${row.v_count }"></td>
        <th th:text="작성일"></th>
        <td th:text="${row.w_date}"></td>
    </tr>
    <tr>
        <th th:text="내용"></th>
        <td th:utext="${row.contents}"></td>
    </tr>

</table>

<div th:if="${row != null} and ${user != null} and ${row.member_id == user.id}">
    <form th:action="'/board/updateQnA/' + ${row.id}" method="get">
        <input type="submit" value="수정">
    </form>
    <form th:action="'/board/deleteQnA/' + ${row.id}" method="post" onsubmit="return delcheck()">
        <input type="submit" value="삭제">
    </form>
</div>

<script>
    function delcheck() {
        return confirm('정말로 삭제하시겠습니까?');
    }
</script>

<h2>댓글</h2>
<hr>
<table th:if="${replies != null}">
    <tr th:each="reply : ${replies}">
        <td th:text="${reply.nick}"></td>
        <td th:text="${reply.contents}"></td>
        <td>작성일: <span th:text="${reply.w_date}"></span></td>
        <td th:if="${user != null and reply.member_id == user.id}">
            <form th:action="'/board/deleteReply/' + ${reply.id}" method="post">
                <input type="hidden" name="board_id" th:value="${row.id}">
                <input type="submit" value="삭제">
            </form>
        </td>
    </tr>
    <tr th:if="${replies == null or #lists.isEmpty(replies)}">
        <td>댓글이 없습니다.</td>
    </tr>
</table>

<div th:if="${row.nick == user.nick }">
    <a href="$/board/updateQnA/${row.idx }">
        <button>수정</button>
    </a>
    <a href="/board/delete/${row.idx }">
        <button>삭제</button>
    </a>
</div>

<div th:if="${user != null}">
    <h3>댓글 작성</h3>
    <form th:action="@{/board/replies}" method="post">
        <input type="hidden" name="board_id" th:value="${row.id}">
        <textarea name="contents"></textarea>
        <input type="submit" value="작성">
    </form>
</div>

<div th:replace="~{piece :: footer}"></div>
</body>
</html>